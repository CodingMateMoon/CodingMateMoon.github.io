---
layout  : wiki
title   : 기본적인 복구의 종류와 동작
summary : 
date    : 2023-07-02 20:19:50 +0900
updated : 2023-07-04 08:58:59 +0900
tag     : oracle
resource: f9/cc6e03-7f8c-49d2-b639-c51bc8022ac1
toc     : true
public  : true
parent  : [[oracle]]
latex   : false
---
* TOC
{:toc}

## 기본적인 복구의 종류와 동작
 충돌(인스턴스) 복구, 미디어 복구
완전 복구, 불완전 복구
데이터베이스/테이블스페이스/데이터 파일/블록의 복구

### 인스턴스 복구와 미디어복구
인스턴스 복구라고 불리는 충돌 복구(crash recovery)는 인스턴스가 비정상 종료된 후 다시 기동할 때 자동으로 수행하는 복구를 의미합니다.
미디어 복구는 디스크의 데이터가 손상되었을 때 사용자가 명시적으로 수행하는 복구입니다. 또한 백업본을 복원한 후 복구하는 것이 아닌 현재 데이터 파일만을 사용하는 방식도 있습니다.

### 완전 복구와 불완전 복구의 차이
완전 복구는 데이터베이스를 최신 데이터까지 복구한다는 것을 의미하고 불완전 복구는 어떤 시점(도중)까지만 복구하는 것을 의미합니다. 일반적으로 완전 복구를 선택하며 아카이브 REDO 로그 유실 등 사정이 있어서 특정 시점의 데이터로 바꾸는 것이 필요할 때 불완전 복구를 수행합니다.

### 데이터베이스/테이블스페이스/데이터 파일/블록의 복구
데이터베이스 복구는 'RECOVER DATABASE'를 입력해서 데이터베이스 전체를 복구하는 것을 의미합니다. 데이터베이스를 중단하지 않고 정상적인 테이블스페이스는 계속 운영하며 손상된 테이블스페이스만을 복구하고 싶은 경우 복구할 테이블스페이스를 사용할 수 없는 상태(오프라인)로 변경하고 테이블스페이스를 복구합니다. 다만 SYSTEM 테이블스페이스 같은 주요 테이블스페이스의 경우 오프라인 상태로 만들면 데이터베이스를 운영할 수 없기 때문에 이러한 복구 방법을 쓸 수는 없습니다.
좀 더 좁은 범위로는 'RECOVER DATAFILE < 데이터 파일명 >'이라고 입력해서 데이터 파일에 대한 복구를 수행할 수 있습니다.
RMAN을 사용할 경우 특정 블록을 지정해서 복구하는 것도 가능합니다. 특정 블록만을 백업된 데이터로 돌려놓고 해당 블록에 관한 REDO 로그만을 사용해서 복구하는 방식으로 해당 블록 외에는 사용 가능한 상태이기 때문에 장애가 국소적으로 발생했을 때 유용합니다.

### RMAN
'Recovery MANager'의 약어로 백업 및 복구를 수행할 수 있는 관리 도구입니다. 변경한 부분만을 백업하는 기능(체인지 트래킹, change tracking)과 백업한 파일의 갱신 기능(증분 백업, incremental backup) 기능 등이 존재합니다. 
증분 백업 기능을 사용할 경우 이전에 받은 풀 백업에 변경된 데이터를 적용할 수 있습니다. 체인지 트래킹과 증분 백업을 합쳐 사용함으로써 필요한 부분만을 읽어 와 풀백업을 항상 최신 데이터로 유지하는 것이 가능합니다. 

## 기본적인 복구의 흐름 (데이터베이스 전체의 복구)
데이터베이스 전체를 복구할 경우 모든 데이터 파일을 복원하고 업무를 정지한 후 복구합니다.
1. 데이터베이스가 손상되었는 지 확인  
2. 재작업할 수 있도록 현재 상태를 백업  
3. 필요한 데이터 파일과 아카이브 REDO 로그 파일을 복원 
4. 복구 실행 


### (1) 데이터베이스가 손상되었는지 확인
컨트롤 파일이 손상되었을 경우 MOUNT 상태가 되기 전에 오라클이 정지할 것이며 초기화 파라미터 파일이 손상되었다면 인스턴스의 기동 자체가 수행되지 않을 것입니다. 데이터 파일에만 발생한 장애라면 MOUNT까지는 성공하고 OPEN에서 실패할 수 있습니다.
데이터 파일에 장애가 발생했을 경우 이를 복구하기 위해서는 MOUNT 상태여야 합니다. 컨트롤 파일을 읽어오지 않은 상태에서는 데이터 파일의 위치를 알 수 없기 때문입니다. MOUNT 상태에서 오라클이 제공해주는 v$recover_file, v$datafile_header와 같은 뷰(view)를 확인할 경우 복구가 필요하다가 인식한 데이터 파일을 확인할 수 있습니다.

## 참고자료
- 그림으로 공부하는 오라클 구조(스기타아츠시 외 4명)
